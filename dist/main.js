(()=>{var j=class{constructor(){this._events={}}on(e,n,s={}){this._events[e]=this._events[e]||[],this._events[e].push({fn:n,options:s})}off(e,n){let s=this._events[e]||[];this._events[e]=s.filter(o=>o.fn!==n)}find(e){return this._events[e]}run(e,...n){let s=this._events[e]||[];return console.assert(s&&s.length>0,"No subscriber for event: "+e),this._events[e]=s.filter(o=>!o.options.once),s.forEach(o=>{let{fn:i,options:a}=o;return a.delay?this.delay(e,i,n,a):i.apply(this,n),!o.options.once}),s.length}once(e,n,s={}){this.on(e,n,Object.assign(Object.assign({},s),{once:!0}))}delay(e,n,s,o){o._t&&clearTimeout(o._t),o._t=setTimeout(()=>{clearTimeout(o._t),n.apply(this,s)},o.delay)}},w,v=typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;v.app&&v._AppRunVersions?w=v.app:(w=new j,v.app=w,v._AppRunVersions="AppRun-2");var c=w;function F(t,...e){return L(e)}function L(t){let e=[],n=s=>{s!=null&&s!==""&&s!==!1&&e.push(typeof s=="function"||typeof s=="object"?s:""+s)};return t&&t.forEach(s=>{Array.isArray(s)?s.forEach(o=>n(o)):n(s)}),e}var R=new WeakMap,U=function(t,e,n={}){if(e==null||e===!1)return;e=E(e,n);let s=(t==null?void 0:t.nodeName)==="SVG";!t||(Array.isArray(e)?C(t,e,s):C(t,[e],s))};function N(t,e,n){e._op!==3&&(n=n||e.tag==="svg",function(s,o){let i=s.nodeName,a=""+(o.tag||"");return i.toUpperCase()===a.toUpperCase()}(t,e)?(!(2&e._op)&&C(t,e.children,n),!(1&e._op)&&M(t,e.props,n)):t.parentNode.replaceChild(k(e,n),t))}function C(t,e,n){var s;let o=((s=t.childNodes)===null||s===void 0?void 0:s.length)||0,i=(e==null?void 0:e.length)||0,a=Math.min(o,i);for(let u=0;u<a;u++){let r=e[u];if(r._op===3)continue;let f=t.childNodes[u];if(typeof r=="string")f.textContent!==r&&(f.nodeType===3?f.nodeValue=r:t.replaceChild(T(r),f));else if(r instanceof HTMLElement||r instanceof SVGElement)t.insertBefore(r,f);else{let p=r.props&&r.props.key;if(p)if(f.key===p)N(t.childNodes[u],r,n);else{let m=R[p];if(m){let d=m.nextSibling;t.insertBefore(m,f),d?t.insertBefore(f,d):t.appendChild(f),N(t.childNodes[u],r,n)}else t.replaceChild(k(r,n),f)}else N(t.childNodes[u],r,n)}}let h=t.childNodes.length;for(;h>a;)t.removeChild(t.lastChild),h--;if(i>a){let u=document.createDocumentFragment();for(let r=a;r<e.length;r++)u.appendChild(k(e[r],n));t.appendChild(u)}}function T(t){if((t==null?void 0:t.indexOf("_html:"))===0){let e=document.createElement("div");return e.insertAdjacentHTML("afterbegin",t.substring(6)),e}return document.createTextNode(t??"")}function k(t,e){if(t instanceof HTMLElement||t instanceof SVGElement)return t;if(typeof t=="string")return T(t);if(!t.tag||typeof t.tag=="function")return T(JSON.stringify(t));let n=(e=e||t.tag==="svg")?document.createElementNS("http://www.w3.org/2000/svg",t.tag):document.createElement(t.tag);return M(n,t.props,e),t.children&&t.children.forEach(s=>n.appendChild(k(s,e))),n}function M(t,e,n){let s=t._props||{};e=function(o,i){i.class=i.class||i.className,delete i.className;let a={};return o&&Object.keys(o).forEach(h=>a[h]=null),i&&Object.keys(i).forEach(h=>a[h]=i[h]),a}(s,e||{}),t._props=e;for(let o in e){let i=e[o];if(o.startsWith("data-")){let a=o.substring(5).replace(/-(\w)/g,h=>h[1].toUpperCase());t.dataset[a]!==i&&(i||i===""?t.dataset[a]=i:delete t.dataset[a])}else if(o==="style")if(t.style.cssText&&(t.style.cssText=""),typeof i=="string")t.style.cssText=i;else for(let a in i)t.style[a]!==i[a]&&(t.style[a]=i[a]);else if(o.startsWith("xlink")){let a=o.replace("xlink","").toLowerCase();i==null||i===!1?t.removeAttributeNS("http://www.w3.org/1999/xlink",a):t.setAttributeNS("http://www.w3.org/1999/xlink",a,i)}else o.startsWith("on")?i&&typeof i!="function"?typeof i=="string"&&(i?t.setAttribute(o,i):t.removeAttribute(o)):t[o]=i:/^id$|^class$|^list$|^readonly$|^contenteditable$|^role|-/g.test(o)||n?t.getAttribute(o)!==i&&(i?t.setAttribute(o,i):t.removeAttribute(o)):t[o]!==i&&(t[o]=i);o==="key"&&i&&(R[i]=t)}e&&typeof e.ref=="function"&&window.requestAnimationFrame(()=>e.ref(t))}function E(t,e,n=0){var s;if(typeof t=="string")return t;if(Array.isArray(t))return t.map(i=>E(i,e,n++));let o=t;if(t&&typeof t.tag=="function"&&Object.getPrototypeOf(t.tag).t&&(o=function(i,a,h){let{tag:u,props:r,children:f}=i,p="_"+h,m=r&&r.id;m?p=m:m=`_${h}${Date.now()}`;let d="section";r&&r.as&&(d=r.as,delete r.as),a.i||(a.i={});let l=a.i[p];if(!(l&&l instanceof u&&l.element)){let _=document.createElement(d);l=a.i[p]=new u(Object.assign(Object.assign({},r),{children:f})).start(_)}if(l.mounted){let _=l.mounted(r,f,l.state);_!==void 0&&l.setState(_)}return M(l.element,r,!1),l.element}(t,e,n)),o&&Array.isArray(o.children)){let i=(s=o.props)===null||s===void 0?void 0:s._component;if(i){let a=0;o.children=o.children.map(h=>E(h,i,a++))}else o.children=o.children.map(a=>E(a,e,n++))}return o}var H=(t,e={})=>class extends HTMLElement{constructor(){super()}get component(){return this._component}get state(){return this._component.state}static get observedAttributes(){return(e.observedAttributes||[]).map(n=>n.toLowerCase())}connectedCallback(){if(this.isConnected&&!this._component){let n=e||{};this._shadowRoot=n.shadow?this.attachShadow({mode:"open"}):this;let s=n.observedAttributes||[],o=s.reduce((h,u)=>{let r=u.toLowerCase();return r!==u&&(h[r]=u),h},{});this._attrMap=h=>o[h]||h;let i={};Array.from(this.attributes).forEach(h=>i[this._attrMap(h.name)]=h.value),s.forEach(h=>{this[h]!==void 0&&(i[h]=this[h]),Object.defineProperty(this,h,{get:()=>i[h],set(u){this.attributeChangedCallback(h,i[h],u)},configurable:!0,enumerable:!0})});let a=this.children?Array.from(this.children):[];if(a.forEach(h=>h.parentElement.removeChild(h)),this._component=new t(Object.assign(Object.assign({},i),{children:a})).mount(this._shadowRoot,n),this._component._props=i,this._component.dispatchEvent=this.dispatchEvent.bind(this),this._component.mounted){let h=this._component.mounted(i,a,this._component.state);h!==void 0&&(this._component.state=h)}this.on=this._component.on.bind(this._component),this.run=this._component.run.bind(this._component),n.render!==!1&&this._component.run(".")}}disconnectedCallback(){var n,s,o,i;(s=(n=this._component)===null||n===void 0?void 0:n.unload)===null||s===void 0||s.call(n),(i=(o=this._component)===null||o===void 0?void 0:o.unmount)===null||i===void 0||i.call(o),this._component=null}attributeChangedCallback(n,s,o){if(this._component){let i=this._attrMap(n);this._component._props[i]=o,this._component.run("attributeChanged",i,s,o),o!==s&&e.render!==!1&&window.requestAnimationFrame(()=>{this._component.run(".")})}}},V=(t,e,n)=>{typeof customElements!="undefined"&&customElements.define(t,H(e,n))},$={meta:new WeakMap,defineMetadata(t,e,n){this.meta.has(n)||this.meta.set(n,{}),this.meta.get(n)[t]=e},getMetadataKeys(t){return t=Object.getPrototypeOf(t),this.meta.get(t)?Object.keys(this.meta.get(t)):[]},getMetadata(t,e){return e=Object.getPrototypeOf(e),this.meta.get(e)?this.meta.get(e)[t]:null}};function B(t,e={}){return function(n,s){let o=t?t.toString():s;$.defineMetadata("apprun-update:"+o,{name:o,key:s,options:e},n)}}function D(t,e){return function(n){return V(t,n,e),n}}var b=(t,e)=>(e?t.state[e]:t.state)||"",y=(t,e,n)=>{if(e){let s=t.state||{};s[e]=n,t.setState(s)}else t.setState(n)},A=new Map;c.on("get-components",t=>t.components=A);var P=t=>t,O=class{constructor(e,n,s,o){this.state=e,this.view=n,this.update=s,this.options=o,this._app=new j,this._actions=[],this._global_events=[],this._history=[],this._history_idx=-1,this._history_prev=()=>{this._history_idx--,this._history_idx>=0?this.setState(this._history[this._history_idx],{render:!0,history:!1}):this._history_idx=0},this._history_next=()=>{this._history_idx++,this._history_idx<this._history.length?this.setState(this._history[this._history_idx],{render:!0,history:!1}):this._history_idx=this._history.length-1},this.start=(i=null,a)=>this.mount(i,Object.assign(Object.assign({},a),{render:!0}))}render(e,n){c.render(e,n,this)}_view(e){if(!this.view)return;let n=c.createElement;c.h=c.createElement=(o,i,...a)=>(i&&Object.keys(i).forEach(h=>{h.startsWith("$")&&(((u,r,f,p)=>{if(u.startsWith("$on")){let m=r[u];if(u=u.substring(1),typeof m=="boolean")r[u]=d=>p.run(u,d);else if(typeof m=="string")r[u]=d=>p.run(m,d);else if(typeof m=="function")r[u]=d=>p.setState(m(p.state,d));else if(Array.isArray(m)){let[d,...l]=m;typeof d=="string"?r[u]=_=>p.run(d,...l,_):typeof d=="function"&&(r[u]=_=>p.setState(d(p.state,...l,_)))}}else if(u==="$bind"){let m=r.type||"text",d=typeof r[u]=="string"?r[u]:r.name;if(f==="input")switch(m){case"checkbox":r.checked=b(p,d),r.onclick=l=>y(p,d||l.target.name,l.target.checked);break;case"radio":r.checked=b(p,d)===r.value,r.onclick=l=>y(p,d||l.target.name,l.target.value);break;case"number":case"range":r.value=b(p,d),r.oninput=l=>y(p,d||l.target.name,Number(l.target.value));break;default:r.value=b(p,d),r.oninput=l=>y(p,d||l.target.name,l.target.value)}else f==="select"?(r.value=b(p,d),r.onchange=l=>{l.target.multiple||y(p,d||l.target.name,l.target.value)}):f==="option"?(r.selected=b(p,d),r.onclick=l=>y(p,d||l.target.name,l.target.selected)):f==="textarea"&&(r.innerHTML=b(p,d),r.oninput=l=>y(p,d||l.target.name,l.target.value))}else c.run("$",{key:u,tag:f,props:r,component:p})})(h,i,o,this),delete i[h])}),n(o,i,...a));let s=this.view(e);return c.h=c.createElement=n,s}renderState(e,n=null){if(!this.view)return;let s=n||this._view(e);if(c.debug&&c.run("debug",{component:this,_:s?".":"-",state:e,vdom:s,el:this.element}),typeof document!="object")return;let o=typeof this.element=="string"?document.getElementById(this.element):this.element;if(o){let i="_c";this.unload?o._component===this&&o.getAttribute(i)===this.tracking_id||(this.tracking_id=new Date().valueOf().toString(),o.setAttribute(i,this.tracking_id),typeof MutationObserver!="undefined"&&(this.observer||(this.observer=new MutationObserver(a=>{a[0].oldValue!==this.tracking_id&&document.body.contains(o)||(this.unload(this.state),this.observer.disconnect(),this.observer=null)})),this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,attributeFilter:[i]}))):o.removeAttribute&&o.removeAttribute(i),o._component=this}n||this.render(o,s),this.rendered&&this.rendered(this.state)}setState(e,n={render:!0,history:!1}){if(e instanceof Promise)Promise.all([e,this._state]).then(s=>{s[0]&&this.setState(s[0])}).catch(s=>{throw console.error(s),s}),this._state=e;else{if(this._state=e,e==null)return;this.state=e,n.render!==!1&&this.renderState(e),n.history!==!1&&this.enable_history&&(this._history=[...this._history,e],this._history_idx=this._history.length-1),typeof n.callback=="function"&&n.callback(this.state)}}mount(e=null,n){var s,o;return console.assert(!this.element,"Component already mounted."),this.options=n=Object.assign(Object.assign({},this.options),n),this.element=e,this.global_event=n.global_event,this.enable_history=!!n.history,this.enable_history&&(this.on(n.history.prev||"history-prev",this._history_prev),this.on(n.history.next||"history-next",this._history_next)),n.route&&(this.update=this.update||{},this.update[n.route]=P),this.add_actions(),this.state=(o=(s=this.state)!==null&&s!==void 0?s:this.model)!==null&&o!==void 0?o:{},typeof this.state=="function"&&(this.state=this.state()),n.render?this.setState(this.state,{render:!0,history:!0}):this.setState(this.state,{render:!1,history:!0}),c.debug&&(A.get(e)?A.get(e).push(this):A.set(e,[this])),this}is_global_event(e){return e&&(this.global_event||this._global_events.indexOf(e)>=0||e.startsWith("#")||e.startsWith("/")||e.startsWith("@"))}add_action(e,n,s={}){n&&typeof n=="function"&&(s.global&&this._global_events.push(e),this.on(e,(...o)=>{c.debug&&c.run("debug",{component:this,_:">",event:e,p:o,current_state:this.state,options:s});let i=n(this.state,...o);c.debug&&c.run("debug",{component:this,_:"<",event:e,p:o,newState:i,state:this.state,options:s}),this.setState(i,s)},s))}add_actions(){let e=this.update||{};$.getMetadataKeys(this).forEach(s=>{if(s.startsWith("apprun-update:")){let o=$.getMetadata(s,this);e[o.name]=[this[o.key].bind(this),o.options]}});let n={};Array.isArray(e)?e.forEach(s=>{let[o,i,a]=s;o.toString().split(",").forEach(h=>n[h.trim()]=[i,a])}):Object.keys(e).forEach(s=>{let o=e[s];(typeof o=="function"||Array.isArray(o))&&s.split(",").forEach(i=>n[i.trim()]=o)}),n["."]||(n["."]=P),Object.keys(n).forEach(s=>{let o=n[s];typeof o=="function"?this.add_action(s,o):Array.isArray(o)&&this.add_action(s,o[0],o[1])})}run(e,...n){let s=e.toString();return this.is_global_event(s)?c.run(s,...n):this._app.run(s,...n)}on(e,n,s){let o=e.toString();return this._actions.push({name:o,fn:n}),this.is_global_event(o)?c.on(o,n,s):this._app.on(o,n,s)}unmount(){var e;(e=this.observer)===null||e===void 0||e.disconnect(),this._actions.forEach(n=>{let{name:s,fn:o}=n;this.is_global_event(s)?c.off(s,o):this._app.off(s,o)})}};O.t=!0;var x=t=>{if(t||(t="#"),t.startsWith("#")){let[e,...n]=t.split("/");c.run(e,...n)||c.run("///",e,...n),c.run("//",e,...n)}else if(t.startsWith("/")){let[e,n,...s]=t.split("/");c.run("/"+n,...s)||c.run("///","/"+n,...s),c.run("//","/"+n,...s)}else c.run(t)||c.run("///",t),c.run("//",t)};c.h=c.createElement=function(t,e,...n){let s=L(n);if(typeof t=="string")return{tag:t,props:e,children:s};if(Array.isArray(t))return t;if(t===void 0&&n)return s;if(Object.getPrototypeOf(t).t)return{tag:t,props:e,children:s};if(typeof t=="function")return t(e,s);throw new Error("Unknown tag in vdom "+t)},c.render=function(t,e,n){U(t,e,n)},c.Fragment=F,c.webComponent=V,c.start=(t,e,n,s,o)=>{let i=Object.assign(Object.assign({},o),{render:!0,global_event:!0}),a=new O(e,n,s);return o&&o.rendered&&(a.rendered=o.rendered),a.mount(t,i),a};var S=t=>{};c.on("$",S),c.on("debug",t=>S),c.on("//",S),c.on("#",S),c.route=x,c.on("route",t=>c.route&&c.route(t)),typeof document=="object"&&document.addEventListener("DOMContentLoaded",()=>{c.route===x&&(window.onpopstate=()=>x(location.hash),document.body.hasAttribute("apprun-no-init")||x(location.hash))}),typeof window=="object"&&(window.Component=O,window.React=c,window.on=B,window.customElement=D);var g=c;var G=0,J=t=>g.h("div",null,g.h("h1",null,t),g.h("button",{$onclick:"-1"},"-1"),g.h("button",{$onclick:"+1"},"+1")),q={"+1":t=>g.run("//ws:","add",t,1),"-1":t=>g.run("//ws:","add",t,-1)};g.start(document.body,G,J,q);var W=new WebSocket(`ws://${location.host}`);W.onopen=()=>console.log("websocket connected");W.onmessage=function(t){console.log(JSON.parse(t.data))};g.on("//ws:",(t,...e)=>{let n={event:t,data:e};console.log("sending event: ",n),W.send(JSON.stringify(n))});})();
//# sourceMappingURL=main.js.map
